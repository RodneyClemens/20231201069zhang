<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <!-- 安全规则：阻止访问.git目录及相关文件 -->
        <security>
            <requestFiltering>
                <hiddenSegments>
                    <add segment=".git" />
                    <add segment=".gitignore" />
                    <add segment=".gitattributes" />
                </hiddenSegments>
                <fileExtensions applyToWebDAV="false">
                    <add fileExtension=".git" allowed="false" />
                </fileExtensions>
            </requestFiltering>
        </security>

        <!-- URL重写规则：阻止任何对.git的访问尝试 - 加强版 -->
        <rewrite>
            <rules>
                <!-- 规则1：匹配任何包含.git的路径 -->
                <rule name="Block .git Access 1" stopProcessing="true">
                    <match url=".*\.git.*" />
                    <action type="CustomResponse" statusCode="404" subStatusCode="0" statusReason="Not Found" statusDescription="The requested resource was not found on this server." />
                </rule>
                <!-- 规则2：专门匹配.git目录 -->
                <rule name="Block .git Access 2" stopProcessing="true">
                    <match url="^\.git(/.*)?$" />
                    <action type="CustomResponse" statusCode="404" subStatusCode="0" statusReason="Not Found" statusDescription="The requested resource was not found on this server." />
                </rule>
            </rules>
        </rewrite>

        <!-- 自定义错误页面 -->
        <httpErrors errorMode="Custom">
            <remove statusCode="404" subStatusCode="-1" />
            <error statusCode="404" path="/404.html" responseMode="ExecuteURL" />
        </httpErrors>

        <!-- 防止目录浏览 -->
        <directoryBrowse enabled="false" />
    </system.webServer>
</configuration>