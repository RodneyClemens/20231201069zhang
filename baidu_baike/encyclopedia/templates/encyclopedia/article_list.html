{% extends 'encyclopedia/base.html' %}

{% block title %}百度百科 - 全球最大的中文百科全书{% endblock %}

{% block content %}
<div id="app">
    <!-- 热点区域 -->
    <div class="hot-section">
        <div class="hot-header">
            <div class="hot-badge">热点</div>
            <div class="keywords-container">
                <div class="keywords-header">
                    <div class="keywords-stats">
                        <span class="keyword-count">共[[ keywords.length ]]个关键词</span>
                        <span class="keyword-hint">点击关键词搜索相关内容</span>
                    </div>
                </div>
                <div class="keywords-list">
                    <span 
                        class="keyword-tag" 
                        v-for="keyword in keywords" 
                        :key="keyword"
                        :class="{ active: activeKeyword === keyword }"
                        @click="selectKeyword(keyword)"
                    >
                        {{ keyword }}
                    </span>
                </div>
            </div>
        </div>
        
        <!-- 热点词条列表 -->
        <div class="hot-articles">
            <div class="article-card" v-for="(article, index) in articles" :key="article.id">
                <div class="article-rank">[[ index + 1 ]]</div>
                <div class="article-content">
                    <a :href="`{% url 'article_detail' 0 %}`.replace('0', article.id)" class="article-title">{{ article.title }}</a>
                    <div class="article-meta">
                        <span class="category">{{ article.category }}</span>
                        <span class="update-time">{{ article.update_time }}</span>
                    </div>
                </div>
                <a :href="`{% url 'article_edit' 0 %}`.replace('0', article.id)" class="edit-btn">编辑</a>
            </div>
        </div>
    </div>
    
    <!-- 回到顶部按钮 -->
    <button v-if="showBackToTop" @click="backToTop" class="back-to-top">回到顶部</button>
</div>

<style>
    /* 热点区域样式 */
    .hot-section {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 24px;
        margin-top: 24px;
    }
    
    .hot-header {
        display: flex;
        align-items: flex-start;
        gap: 30px;
        margin-bottom: 24px;
    }
    
    .hot-badge {
        background-color: #ff4757;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 16px;
        min-width: 60px;
        text-align: center;
    }
    
    .keywords-header {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 16px;
         flex-wrap: wrap;
         gap: 10px;
     }
     
     .keywords-stats {
         display: flex;
         align-items: center;
         gap: 16px;
     }
     
     .keyword-count {
         color: #1a73e8;
         font-size: 14px;
         font-weight: 500;
     }
     
     .keyword-hint {
         color: #9aa0a6;
         font-size: 13px;
     }
     
     .keywords-list {
         display: flex;
         flex-wrap: wrap;
         gap: 12px;
         background-color: #f8f9fa;
         padding: 16px;
         border-radius: 8px;
         border: 1px solid #e8eaed;
     }
     
     .keyword-tag {
         background-color: white;
         color: #5f6368;
         padding: 8px 16px;
         border-radius: 20px;
         font-size: 14px;
         cursor: pointer;
         transition: all 0.2s ease;
         border: 1px solid #dadce0;
         position: relative;
         overflow: hidden;
     }
     
     .keyword-tag:hover {
         background-color: #1a73e8;
         color: white;
         border-color: #1a73e8;
         transform: translateY(-1px);
         box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
     }
     
     .keyword-tag.active {
         background-color: #1a73e8;
         color: white;
         border-color: #1a73e8;
         box-shadow: 0 2px 8px rgba(26, 115, 232, 0.3);
     }
     
     .keyword-tag::before {
         content: '';
         position: absolute;
         top: 50%;
         left: 50%;
         width: 0;
         height: 0;
         border-radius: 50%;
         background-color: rgba(255, 255, 255, 0.2);
         transform: translate(-50%, -50%);
         transition: width 0.3s, height 0.3s;
     }
     
     .keyword-tag:active::before {
         width: 100px;
         height: 100px;
     }
    
    /* 热点词条列表样式 */
    .hot-articles {
        border-top: 1px solid #e0e0e0;
        padding-top: 16px;
    }
    
    .article-card {
        display: flex;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid #f1f3f4;
        transition: background-color 0.2s ease;
    }
    
    .article-card:last-child {
        border-bottom: none;
    }
    
    .article-card:hover {
        background-color: #f8f9fa;
    }
    
    .article-rank {
        font-size: 24px;
        font-weight: bold;
        color: #1a73e8;
        width: 40px;
        text-align: center;
    }
    
    .article-content {
        flex: 1;
        margin: 0 20px;
    }
    
    .article-title {
        font-size: 18px;
        color: #202124;
        text-decoration: none;
        margin-bottom: 8px;
        display: block;
        font-weight: 500;
    }
    
    .article-title:hover {
        color: #1a73e8;
        text-decoration: underline;
    }
    
    .article-meta {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .category {
        background-color: #e8f0fe;
        color: #1a73e8;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
    }
    
    .update-time {
        color: #5f6368;
        font-size: 14px;
    }
    
    .edit-btn {
        padding: 6px 16px;
        border: 1px solid #dadce0;
        background-color: white;
        color: #202124;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s ease;
    }
    
    .edit-btn:hover {
        background-color: #f8f9fa;
        border-color: #1a73e8;
        color: #1a73e8;
    }
    
    /* 回到顶部按钮 */
    .back-to-top {
        position: fixed;
        bottom: 40px;
        right: 40px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background-color: #1a73e8;
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }
    
    .back-to-top:hover {
        background-color: #1557b0;
        transform: translateY(-4px);
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
        .hot-header {
            flex-direction: column;
            gap: 16px;
        }
        
        .article-card {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
        
        .article-rank {
            align-self: flex-start;
            width: auto;
        }
        
        .article-content {
            margin: 0;
            width: 100%;
        }
        
        .edit-btn {
            align-self: flex-end;
        }
        
        .back-to-top {
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
        }
    }
</style>

<script>
    new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data: {
            articles: [],
            keywords: ['科学', '历史', '文化', '艺术', '体育', '娱乐', '科技', '教育', '健康', '旅游', '美食', '汽车', '财经', '军事', '动漫'],
            showBackToTop: false,
            activeKeyword: null,
            // 模拟热点数据，确保页面能正常显示
            mockArticles: [
                {id: '1', title: '人工智能的发展历史与未来趋势', category: '科技', update_time: '2025-10-27'},
                {id: '2', title: '新冠疫情对全球经济的影响分析', category: '财经', update_time: '2025-10-26'},
                {id: '3', title: '元宇宙：虚拟现实的新纪元', category: '科技', update_time: '2025-10-25'},
                {id: '4', title: '气候变化与环境保护的全球合作', category: '科学', update_time: '2025-10-24'},
                {id: '5', title: '量子计算：突破传统计算极限', category: '科技', update_time: '2025-10-23'},
                {id: '6', title: '中国古代四大发明的历史意义', category: '历史', update_time: '2025-10-22'},
                {id: '7', title: '奥运会：人类体育精神的象征', category: '体育', update_time: '2025-10-21'},
                {id: '8', title: '中医养生：传统智慧的现代应用', category: '健康', update_time: '2025-10-20'},
                {id: '9', title: '太空探索：人类的星际梦想', category: '科学', update_time: '2025-10-19'},
                {id: '10', title: '世界文化遗产：人类共同的财富', category: '文化', update_time: '2025-10-18'}
            ]
        },
        mounted() {
            // 初始化加载所有词条
            this.fetchArticles();
            
            // 监听滚动事件
            window.addEventListener('scroll', this.handleScroll);
        },
        beforeDestroy() {
            window.removeEventListener('scroll', this.handleScroll);
        },
        methods: {
            fetchArticles() {
                const url = `/api/search/?keyword=&category=`;
                
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.articles && data.articles.length > 0) {
                            this.articles = data.articles.slice(0, 10); // 最多显示10条
                        } else {
                            // 如果API没有返回数据，使用模拟数据
                            this.articles = this.mockArticles;
                        }
                    })
                    .catch(error => {
                        console.error('获取词条失败:', error);
                        // 如果API调用失败，使用模拟数据
                        this.articles = this.mockArticles;
                    });
            },
            handleScroll() {
                // 当滚动超过300px时显示回到顶部按钮
                this.showBackToTop = window.scrollY > 300;
            },
            backToTop() {
                // 平滑滚动到顶部
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            },
            selectKeyword(keyword) {
                // 点击关键词时的处理
                this.activeKeyword = keyword;
                
                // 执行实际搜索，根据关键词筛选文章
                const searchTerm = keyword.toLowerCase();
                
                // 先尝试从API获取数据
                const url = `/api/search/?keyword=${encodeURIComponent(searchTerm)}&category=`;
                
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data.articles && data.articles.length > 0) {
                            this.articles = data.articles;
                        } else {
                            // 如果API没有返回匹配结果，在本地模拟数据中搜索
                            this.filterArticlesByKeyword(searchTerm);
                        }
                    })
                    .catch(error => {
                        console.error('搜索失败:', error);
                        // API调用失败时在本地模拟数据中搜索
                        this.filterArticlesByKeyword(searchTerm);
                    });
            },
            filterArticlesByKeyword(keyword) {
                // 在本地数据中根据关键词筛选文章（搜索标题和分类）
                const filtered = this.mockArticles.filter(article => {
                    return article.title.toLowerCase().includes(keyword) || 
                           article.category.toLowerCase().includes(keyword);
                });
                
                if (filtered.length > 0) {
                    this.articles = filtered;
                } else {
                    // 如果没有精确匹配，尝试相似匹配
                    const similar = this.mockArticles.filter(article => {
                        // 简单的相似性匹配逻辑，可以根据需要优化
                        return article.title.includes(keyword) || 
                               this.getSimilarity(article.title, keyword) > 0.3;
                    });
                    this.articles = similar.length > 0 ? similar : [];
                }
            },
            getSimilarity(str1, str2) {
                // 简单的字符串相似度计算（可以根据需要使用更复杂的算法）
                const len1 = str1.length;
                const len2 = str2.length;
                let matches = 0;
                
                for (let i = 0; i < Math.min(len1, len2); i++) {
                    if (str1[i] === str2[i]) {
                        matches++;
                    }
                }
                
                return matches / Math.max(len1, len2);
            }
        }
    });
</script>
{% endblock %}